import unittest

from libtrust import rsa_key
from tests import fixtures_path


class RSAKeyTest(unittest.TestCase):
    def setUp(self):
        with open(fixtures_path('private.pem'), 'r') as f:
            self.private_key = rsa_key.RSAPrivateKey.from_pem(f.read())
        with open(fixtures_path('public.pem'), 'r') as f:
            self.public_key = rsa_key.RSAPublicKey.from_pem(f.read())

    def test_key_id(self):
        pubkey_key_id = self.public_key.key_id()
        priv_key_id = self.private_key.key_id()
        self.assertEqual('IIYO:OWAZ:MBMG:2SIK:IK2I:OP5Z:H6QR:KN6Y:QUGO:BUWN:TYW3:JXVW', pubkey_key_id)
        self.assertEqual(pubkey_key_id, priv_key_id)

    def test_marshal_json(self):
        pubkey_json = self.public_key.marshal_json()
        privkey_json = self.private_key.marshal_json()
        pubkey_json_origin = r"""{"e":"AQAB","kid":"IIYO:OWAZ:MBMG:2SIK:IK2I:OP5Z:H6QR:KN6Y:QUGO:BUWN:TYW3:JXVW","kty":"RSA","n":"wq1mCmgn460MC6MnCqranQNTgmKuKPl7bNH7Qc6hBDGHlnIjU6q_h2KXF37TC5Y9tsKvQ4b8jd0Sf0dXFHml8qunSvNnqsSvoD8tSPUKqXS6jrlbGSQXhya7BL1RPGccD5K1xrV73QlI6uFPd3APRQYij5EOB8IOWEQujJk_8Mjc0EC9zvk5TUJb59hkOUPZ3CkvSBNLNS8wpQI98FRnIzHjuaNicqve8054oxmDKifHWy0nnF135cXW8zkH3Zto1q89zD2g-zcVxLcRP84Uhe0nSQyg7vEYl4Wl74Eo6_89qL2yE0mEiQN245ACA5B8WFV_t3j_OD3ydOCaAOg28vQtzcZ1gh2Ev4RxeR7bKq58g-R0-MMwl7nnW29mbCkcgdVVR4YPmglP7Vb6w7_NbqFhnxx4E3A05AeevHdMdYCrtgQwogvIhdOHLcVQxJgwy1d2Lg_mv9rovhCJ7d3XaNEYym6CplCHPMtfnU1LCVkA6b44pFaOVjsAQ8FviFtGXQAToRtwoszSarzslHKYdPoSGFOsgNJgW67iViOYqGPD97rgJA0VPm0POMNHGw_R6o-08KhDF_OI1EDckmjXhUggY_WCqWDxD77Ezd_wr9Zlbv_uSIEL9ifvBLq06lLcXMLrQbJrwMbDrngMZMAcUkTzThmtxNs4uwu45R-zfKc"}"""
        privkey_json_origin = r"""{"d":"tu9aQ808LqYd-5GEznFenMzTXGJ-ZeKKKOfowx34EIi6cJUwvR5mfEIY2OtERk8YDvVC3KGsEWL8Tr4rBgKJ_k9vFO9FKyNIJb04QKaDLlmSNSvYfvd7ZHTwqLN98tSxebDTP7aqfjqLWqv-kK2sq5_oOiCEnqWr9SWc2GHpw8n8NXWg5y0qu37v_h1JkMZBorDQzVnUAlYlz-kbawrlIB1xcLAngroe92N12U3QA3z9yJ_V6Qmr8S7HniapTYUMLzDdUV9YNri8q-2bN-nfPzprACnt0JqeEUR1eWpVme5vcnFPNPCQqm-m-JAKVG8haaBuM2pv6dnMTCgCj3emqWLVfBoc3qmi1KJT_dG54GRepIyN82jFDByKqQGMMO5_Chf2DlRYQYBrkPI5hIZLvbU-a1K5Uf1wauNpGgiGCEjxiXsYGUPyCjAgMmNwnNjfOO7U5KQQMV1PbEj1iPU0xw_Q7adqKd4UeD_rwaTo00KcH6K7_1pFZP3UrkcQ5de9nI_jULIF7YCPqZxs5_dpK8HGwF5VroYIjyVm5AVh9xaE3sugxf8nsdopLybIwcR7nk2RCibW7ClbsJd7eTrYiuPBI50Lb3I-CLczo6VgvlnnqhVDs_kYDZA9c4j11ayAW7l4zc47cPjK6M-ggvL4zqc2n7Ba0Z2Med07hiNrHwE","dp":"MUMOUuBHrByzXNNEsKXFTOOFvOt_eVSorlL2KTcQQjHTSoxv7jY1yqfx41qNNRn6rlcjwGf3_GLuN5bq8zHX37vDD2O5uQDbDmGZc4W0X4E7ZDAY7UTMi_DONzf7Pu-8pN7mBneeLSuUoL-lduNLzC0b-0kOLHG7WCGA5Y9wJT8_fz9h25Yf8BmCe3peuDMwT5E-RHlnk4epQFno_bVz7ZVawE9EpE7FY3l34JOSKrh0hIIz_w1QmFt1fabSfrueM3igaibrc5DyeRmAT0xtLQUUbuzXvycmU-S6VqOwQET6LEVsCaZKGwzRqXXwSTIsyAdNHTg1Oyqdu1jsxt3u8Q","dq":"fKcxyUxSlDYOBky14bORjN3fEujFMgZd4cdIWIyaCzgWMPZIMAJKRfTguH76Msg2rZQ5sIuUetXfBdF7o7k7Zndl_inNuirRclb3Ggty7wfVddk-qIfbGwX_rsqD_H4hnFj2ARBSZO6MAua99ZWERqHpi50vqwBG-iftm9MDEbyp3qUixqHH765bXcOnm2abHOwD_F_Oj1QXECdh76OteZ_13Gz7e9dz9xn2QeEs4_Sg84LUCTDcfy42uGRMx2kKHzUEGh120tqLY5X0sRG8wgUgA4e-By-yAXODjCbApfxFCz1ObCVwJqXmCk66nTp1n1X2du11ht4SWouOooM83Q","e":"AQAB","kid":"IIYO:OWAZ:MBMG:2SIK:IK2I:OP5Z:H6QR:KN6Y:QUGO:BUWN:TYW3:JXVW","kty":"RSA","n":"wq1mCmgn460MC6MnCqranQNTgmKuKPl7bNH7Qc6hBDGHlnIjU6q_h2KXF37TC5Y9tsKvQ4b8jd0Sf0dXFHml8qunSvNnqsSvoD8tSPUKqXS6jrlbGSQXhya7BL1RPGccD5K1xrV73QlI6uFPd3APRQYij5EOB8IOWEQujJk_8Mjc0EC9zvk5TUJb59hkOUPZ3CkvSBNLNS8wpQI98FRnIzHjuaNicqve8054oxmDKifHWy0nnF135cXW8zkH3Zto1q89zD2g-zcVxLcRP84Uhe0nSQyg7vEYl4Wl74Eo6_89qL2yE0mEiQN245ACA5B8WFV_t3j_OD3ydOCaAOg28vQtzcZ1gh2Ev4RxeR7bKq58g-R0-MMwl7nnW29mbCkcgdVVR4YPmglP7Vb6w7_NbqFhnxx4E3A05AeevHdMdYCrtgQwogvIhdOHLcVQxJgwy1d2Lg_mv9rovhCJ7d3XaNEYym6CplCHPMtfnU1LCVkA6b44pFaOVjsAQ8FviFtGXQAToRtwoszSarzslHKYdPoSGFOsgNJgW67iViOYqGPD97rgJA0VPm0POMNHGw_R6o-08KhDF_OI1EDckmjXhUggY_WCqWDxD77Ezd_wr9Zlbv_uSIEL9ifvBLq06lLcXMLrQbJrwMbDrngMZMAcUkTzThmtxNs4uwu45R-zfKc","p":"6ql31IHaMnhXtM0Bv13awqXzujVMfdzVEpBA1NEGdiiEaroLlfpX6tHmrlJnYEJjEk5pwXldTcu5fOBgphEZ985VR8O7nOhxtsYNt0RJe_34SSeUeZNK2kCSB-4uy8TSICUepzL1e59sj7pzHXNz6fxbG-SjGk8dUphgS1QsmJGsFw1hcjYs_yvGfAPpRb0Y8qs4yM3yeKLKq-qW3IFjiAsrrw7w2IEXmUQgyXhdv9DySSPr7WrDL2AV5yV6WouloDABPhlV-ZtCsIvN_5Eu9GTN8kEZ3TiOg7j2IFcP0MKanPbQT4ivYXIAfS7Pt2cVlpwGfCxBtaRk425rGZ3viQ","q":"1GEn69ysWOsGN-U_R9ifaK7RsrfssRsjr7FE_KpWfXqBaUaKLYL6DUc3J4RIr9IP4MQw9gMl6TOXI16G-d6jXtsKODIFHGvkWTxs_iPkOWnBPTTHgklCIdev9MfVxctN-dB_UI6ayEZ_mooWoUQYaZEEwxHRY1Xn0VpWJMSCGfQf3FJEoI3u5HnWaz_HjrCDbJ7u0ZyXJdUn_-IXjZFDsTz_lwaq_dmVsW2KcOVASKHIBGQXdAGwN6fe7XO3MJvLt9oB4mGgCKJgON8IJx9OF0CplF66QmduIAIptnYzwYbeTtcU1y0IAApOj0dj3jmnOzBXnYdbZ7L3mu7glnlOrw","qi":"Qh5chO-_2sdaREPCXOGXMMmw2Ajci-rKAE9HFWaWXSRaduf_P_tPaBV4V4wnFsw6MYaZECgK1wW-u2FpYWdCWF1AyeSIx7egATmfwdpHDPF9ebjSneem9KNhrPPc0MXmYR--cPAVhgtvTq4IV-x32kDUWJQN6VTgvwWmFjL7lrxiq30_TyYopi2pqinnFRGuMj8gWDRi_YmOwrii49t6mmteYS48R8H59DqazVqXIMMc2nIUt9LZs5QGzpoYkyBsMdCIFmJV5mHFeCxVD6S5-3rvD_fCSiCRT94YQbYdHkKQnn3JpUmnpIwraBxNJErjRs-PRTAzMSAts-im_bCAXQ"}"""
        self.assertEqual(pubkey_json_origin, pubkey_json)
        self.assertEqual(privkey_json_origin, privkey_json)
